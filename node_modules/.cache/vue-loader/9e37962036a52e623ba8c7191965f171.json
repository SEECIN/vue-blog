{"remainingRequest":"D:\\桌面\\页面练习\\vue-blog\\vue-blog\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\桌面\\页面练习\\vue-blog\\vue-blog\\src\\components\\m\\BaseForm.vue?vue&type=style&index=0&lang=stylus&","dependencies":[{"path":"D:\\桌面\\页面练习\\vue-blog\\vue-blog\\src\\components\\m\\BaseForm.vue","mtime":1631517108206},{"path":"D:\\桌面\\页面练习\\vue-blog\\vue-blog\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\桌面\\页面练习\\vue-blog\\vue-blog\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\桌面\\页面练习\\vue-blog\\vue-blog\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\桌面\\页面练习\\vue-blog\\vue-blog\\node_modules\\stylus-loader\\index.js","mtime":1519606876000},{"path":"D:\\桌面\\页面练习\\vue-blog\\vue-blog\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\桌面\\页面练习\\vue-blog\\vue-blog\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCg0KLmJsb2dtLWZvcm0NCiAgd2lkdGggMTAwJQ0KLmJsb2dtLWZvcm0tLWNlbGwNCiAgLnZhbi1maWVsZF9fdmFsdWUNCiAgICBsaW5lLWhlaWdodCAzNXB4DQogIC52YW4tZmllbGRfX2xhYmVsDQogICAgd2lkdGggNWVtDQogICAgbWFyZ2luLXJpZ2h0IDANCiAgLnZhbi11cGxvYWRlcl9fdXBsb2FkLWljb24NCiAgICB0ZXh0LWluZGVudCAwDQouYmxvZ20tZm9ybS0tdGl0bGUNCiAgbWFyZ2luIDIwcHggMA0KICBmb250LXNpemUgMjBweA0KICBmb250LXdlaWdodCA2MDANCiAgdGV4dC1hbGlnbiBjZW50ZXINCi5ibG9nbS1mb3JtLS10YWcNCiAgbWFyZ2luIDE2cHggMjBweCAwIDANCiAgZm9udC1zaXplIDEycHgNCiAgdGV4dC1hbGlnbiByaWdodA0KICBzcGFuDQogICAgY29sb3IgIzE5ODlmYQ0K"},{"version":3,"sources":["BaseForm.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0KA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"BaseForm.vue","sourceRoot":"src/components/m","sourcesContent":["<template>\r\n  <van-form @submit=\"onSubmit\"\r\n            class=\"blogm-form\">\r\n    <h3 class=\"blogm-form--title\">{{title}}</h3>\r\n    <van-field class=\"blogm-form--cell\"\r\n               v-for=\"item in formData\"\r\n               :key=\"item['query']\"\r\n               v-model=\"form[item['query']]\"\r\n               :readonly=\"item['query'] === 'username' && type==='userInfo'\"\r\n               :name=\"item['query']==='avatar'? item['lable']: 'uploader'\"\r\n               :label=\"item['label']\"\r\n               :type=\"item['type']\"\r\n               :placeholder=\"item['placeholder']\"\r\n               :rules=\"validates[item['query']] | formatRuleTrigger\">\r\n      <template v-if=\"item['query']==='avatar'\"\r\n                #input>\r\n        <van-uploader v-model=\"upload\"\r\n                      :after-read=\"afterRead\"\r\n                      :max-count=\"1\"\r\n                      :max-size=\"500 * 1024\"\r\n                      @oversize=\"onOversize\" />\r\n      </template>\r\n    </van-field>\r\n    <p class=\"blogm-form--tag\"\r\n       v-if=\"tagValue\">\r\n      {{tagValue}}\r\n      <span @click=\"changeType\">{{spanValue}}</span>\r\n    </p>\r\n    <div style=\"margin: 16px;\">\r\n      <van-button round\r\n                  block\r\n                  type=\"info\"\r\n                  native-type=\"submit\">{{btnName}}</van-button>\r\n    </div>\r\n  </van-form>\r\n</template>\r\n\r\n<script>\r\nimport FORM_DATA from '@/config/form.config'\r\nimport VALIDATE_DATA from '@/config/validate.config'\r\nimport MODAL_DATA from '@/config/modal.config'\r\nimport _padStart from 'lodash/padStart'\r\nimport _capitalize from 'lodash/capitalize'\r\nimport { mapGetters, mapActions } from 'vuex'\r\nimport { Toast } from 'vant'\r\nconst TAG_VALUE = {\r\n  'login': '还没有账号?',\r\n  'register': '已有账号?',\r\n  'userInfo': ''\r\n}\r\nconst SPAN_VALUE = {\r\n  'login': '点击注册',\r\n  'register': '点击登录'\r\n}\r\nconst BTN_NAME = {\r\n  'login': '登录',\r\n  'register': '注册',\r\n  'userInfo': '修改'\r\n}\r\nexport default {\r\n  name: 'BaseForm',\r\n  components: {\r\n\r\n  },\r\n  props: {\r\n\r\n  },\r\n  data () {\r\n    return {\r\n      form: {},\r\n      type: 'userInfo',\r\n      upload: []\r\n    }\r\n  },\r\n  created () {\r\n\r\n  },\r\n  updated () {\r\n\r\n  },\r\n  mounted () {\r\n    let isLogin = this.$store.state.token\r\n    if (!isLogin) {\r\n      this.type = 'login'\r\n    }\r\n    if (this.type === \"userInfo\") {\r\n      this.form = this.formUserInfo\r\n    }\r\n  },\r\n  filters: {\r\n    formatRuleTrigger (rules) {\r\n      return rules?.map(item => {\r\n        item.trigger = _padStart(_capitalize(item.trigger), 6, 'on')\r\n        return item\r\n      })\r\n    },\r\n  },\r\n  computed: {\r\n    formUserInfo () {\r\n      return Object.fromEntries(Object.entries(this.$store.getters.userInfo).filter(([key]) => {\r\n        return FORM_DATA['userInfo'].find(item => {\r\n          return key == item['query']\r\n        })\r\n      }))\r\n    },\r\n    formData () {\r\n      return FORM_DATA[this.type]\r\n    },\r\n    title () {\r\n      return MODAL_DATA[this.type]?.title\r\n    },\r\n    tagValue () {\r\n      return TAG_VALUE[this.type]\r\n    },\r\n    spanValue () {\r\n      return SPAN_VALUE[this.type]\r\n    },\r\n    validates () {\r\n      return VALIDATE_DATA\r\n    },\r\n    btnName () {\r\n      return BTN_NAME[this.type]\r\n    },\r\n    ...mapGetters(['userInfo'])\r\n  },\r\n  watch: {\r\n    type (newType) {\r\n      this.initForm()\r\n      if (newType === 'userInfo') {\r\n        this.form = this.formUserInfo\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n    async onSubmit () {\r\n      try {\r\n        let type = this.type === 'userInfo' ? \"putUserInfo\" : this.type\r\n        await this.$api({ type: type, data: this.form })\r\n        await this.getUserInfo()\r\n        Toast(`${BTN_NAME[this.type]}成功`)\r\n        this.type = 'userInfo'\r\n      } catch (error) {\r\n        Toast({ message: error })\r\n      }\r\n    },\r\n    async afterRead (upload) {\r\n      let formData = new FormData()\r\n      formData.append('avatar', upload.file)\r\n      try {\r\n        let result = await this.$api({ type: 'avatar', data: formData })\r\n        this.form.avatar = result.fileURL\r\n      } catch (error) {\r\n        Toast({ message: error.message })\r\n      }\r\n    },\r\n    changeType () {\r\n      this.type = this.type === 'login' ? 'register' : 'login'\r\n    },\r\n    onOversize () {\r\n      Toast('文件大小不能超过 500kb')\r\n    },\r\n    initForm () {\r\n      //重置表单字段 以及校验状态\r\n      this.form = {}\r\n    },\r\n    ...mapActions(['getUserInfo'])\r\n  },\r\n}\r\n</script>\r\n<style lang='stylus'>\r\n.blogm-form\r\n  width 100%\r\n.blogm-form--cell\r\n  .van-field__value\r\n    line-height 35px\r\n  .van-field__label\r\n    width 5em\r\n    margin-right 0\r\n  .van-uploader__upload-icon\r\n    text-indent 0\r\n.blogm-form--title\r\n  margin 20px 0\r\n  font-size 20px\r\n  font-weight 600\r\n  text-align center\r\n.blogm-form--tag\r\n  margin 16px 20px 0 0\r\n  font-size 12px\r\n  text-align right\r\n  span\r\n    color #1989fa\r\n</style>"]}]}