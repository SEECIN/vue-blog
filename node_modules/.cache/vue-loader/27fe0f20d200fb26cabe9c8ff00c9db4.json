{"remainingRequest":"D:\\桌面\\页面练习\\vue-blog\\vue-blog\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\桌面\\页面练习\\vue-blog\\vue-blog\\src\\components\\m\\BaseArticleFootBar.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\桌面\\页面练习\\vue-blog\\vue-blog\\src\\components\\m\\BaseArticleFootBar.vue","mtime":1632536454268},{"path":"D:\\桌面\\页面练习\\vue-blog\\vue-blog\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\桌面\\页面练习\\vue-blog\\vue-blog\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\桌面\\页面练习\\vue-blog\\vue-blog\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\桌面\\页面练习\\vue-blog\\vue-blog\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgVnVlc2Nyb2xsIGZyb20gJ3Z1ZXNjcm9sbCcNCmltcG9ydCB7IFRvYXN0IH0gZnJvbSAndmFudCcNCmltcG9ydCB7IGNyZWF0ZU5hbWVzcGFjZWRIZWxwZXJzIH0gZnJvbSAndnVleCcNCmNvbnN0IHsgbWFwR2V0dGVycywgbWFwQWN0aW9ucyB9ID0gY3JlYXRlTmFtZXNwYWNlZEhlbHBlcnMoJ2xpa2VzJykNCmV4cG9ydCBkZWZhdWx0IHsNCiAgbmFtZTogJ0Jhc2VBcnRpY2xlRm9vdEJhcicsDQogIGNvbXBvbmVudHM6IHsNCiAgICBWdWVzY3JvbGwNCiAgfSwNCiAgcHJvcHM6IHsNCiAgICBhcnRpY2xlOiB7DQogICAgICB0eXBlOiBTdHJpbmcNCiAgICB9DQogIH0sDQogIGRhdGEgKCkgew0KICAgIHJldHVybiB7DQogICAgICBpc0luaXRMaWtlOiBmYWxzZSwNCiAgICAgIHNob3c6IGZhbHNlLA0KICAgICAgY29tbWVudFZhbDogJycsDQogICAgICBjb21tZW50TGlzdDogW10sDQogICAgICBvcHM6IHsNCiAgICAgICAgYmFyOiB7DQogICAgICAgICAgYmFja2dyb3VuZDogJyNjMWMxYzEnLA0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICB9LA0KICBjcmVhdGVkICgpIHsNCiAgICB0aGlzLmNvbW1lbnRMaXN0ID0gdGhpcy5hcnRpY2xlPy5jb21tZW50cz8ucmV2ZXJzZSgpDQogICAgdGhpcy5pc0luaXRMaWtlID0gdGhpcy5pc0xpa2UNCiAgfSwNCiAgY29tcHV0ZWQ6IHsNCiAgICBjb21tZW50c0xlbmd0aCAoKSB7DQogICAgICByZXR1cm4gdGhpcy5hcnRpY2xlPy5jb21tZW50cz8ubGVuZ3RoDQogICAgfSwNCiAgICBpc0xpa2UgKCkgew0KICAgICAgcmV0dXJuIHRoaXMuaGFkTGlrZSh0aGlzLmFydGljbGU/LmlkKQ0KICAgIH0sDQogICAgbGlrZU51bSAoKSB7DQogICAgICBsZXQgc3RlcCA9IE51bWJlcih0aGlzLmlzTGlrZSkgLSAxDQogICAgICByZXR1cm4gTWF0aC5tYXgodGhpcy5hcnRpY2xlPy5saWtlX251bSArICF0aGlzLmlzSW5pdExpa2UgKyBzdGVwLCAwKQ0KICAgIH0sDQogICAgaGl0TnVtICgpIHsNCiAgICAgIHJldHVybiB0aGlzLmFydGljbGU/LmhpdF9udW0NCiAgICB9LA0KICAgIGNvbW1lbnROdW0gKCkgew0KICAgICAgcmV0dXJuIHRoaXMuYXJ0aWNsZT8uY29tbWVudF9udW0NCiAgICB9LA0KICAgIC4uLm1hcEdldHRlcnMoWydoYWRMaWtlJ10pDQogIH0sDQogIHdhdGNoOiB7DQoNCiAgfSwNCiAgbWV0aG9kczogew0KICAgIGNvbW1lbnQgKCkgew0KICAgICAgdGhpcy5zaG93ID0gdHJ1ZQ0KICAgIH0sDQogICAgbGlrZSAoKSB7DQogICAgICB0aGlzW3RoaXMuaXNMaWtlID8gJ3B1bGxMaWtlcycgOiAncHVzaExpa2VzJ10oeyBhaWQ6IHRoaXMuYXJ0aWNsZS5faWQgfSkNCiAgICAgIHRoaXMudXBkYXRlTGlrZXMoeyBhaWQ6IHRoaXMuYXJ0aWNsZS5faWQgfSkNCiAgICB9LA0KICAgIC4uLm1hcEFjdGlvbnMoWydwdWxsTGlrZXMnLCAncHVzaExpa2VzJywgJ3VwZGF0ZUxpa2VzJ10pLA0KICAgIGFzeW5jIHN1Ym1pdENvbW1lbnQgKCkgew0KICAgICAgbGV0IGlzTG9naW4gPSB0aGlzLiRzdG9yZS5zdGF0ZS50b2tlbg0KICAgICAgaWYgKCFpc0xvZ2luKSB7DQogICAgICAgIFRvYXN0KHsgbWVzc2FnZTogJ+eZu+W9leWQjuWNs+WPr+WPkeihqOivhOiuuicgfSkNCiAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goeyBuYW1lOiAnbVVzZXInLCBxdWVyeTogJ01Vc2VyJyB9KQ0KICAgICAgICByZXR1cm4NCiAgICAgIH0NCiAgICAgIGlmICh0aGlzLmNvbW1lbnRWYWwudHJpbSgpLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICBUb2FzdCh7IG1lc3NhZ2U6ICfor7fovpPlhaXor4TorrrlhoXlrrknIH0pDQogICAgICAgIHJldHVybg0KICAgICAgfQ0KICAgICAgdHJ5IHsNCiAgICAgICAgYXdhaXQgdGhpcy4kYXBpKHsgdHlwZTogJ3Bvc3RDb21tZW50JywgZGF0YTogeyBhaWQ6IHRoaXMuYXJ0aWNsZS5faWQsIGNvbnRlbnQ6IHRoaXMuY29tbWVudFZhbCB9IH0pDQogICAgICAgIFRvYXN0LnN1Y2Nlc3MoJ+ivhOiuuuaIkOWKnycpDQogICAgICAgIHRoaXMuJEV2ZW50QnVzLiRlbWl0KCd1cGxvYWRBcnRpY2xlJykNCiAgICAgICAgdGhpcy4kRXZlbnRCdXMuJG9uKCdhcnRpY2xlSW5mbycsIGRhdGEgPT4gew0KICAgICAgICAgIHRoaXMuY29tbWVudExpc3QgPSBkYXRhLmNvbW1lbnRzLnJldmVyc2UoKQ0KICAgICAgICB9KQ0KICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgVG9hc3QoeyBtZXNzYWdlOiBlcnJvciB9KQ0KICAgICAgfQ0KICAgICAgdGhpcy5jb21tZW50VmFsID0gJycNCiAgICB9DQogIH0sDQogIGJlZm9yZURlc3Ryb3kgKCkgew0KICAgIHRoaXMuJEV2ZW50QnVzLiRvZmYoJ2FydGljbGVJbmZvJykNCiAgfQ0KfQ0K"},{"version":3,"sources":["BaseArticleFootBar.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"BaseArticleFootBar.vue","sourceRoot":"src/components/m","sourcesContent":["<template>\r\n  <van-tabbar active-color=\"#7d7e80\">\r\n    <van-tabbar-item icon=\"eye-o\">{{hitNum}}</van-tabbar-item>\r\n    <van-tabbar-item icon=\"comment-o\"\r\n                     @click=\"comment\">{{commentNum}}</van-tabbar-item>\r\n    <van-tabbar-item class=\"blogm-article--like\"\r\n                     icon=\"good-job-o\"\r\n                     :class=\"{active:isLike}\"\r\n                     @click=\"like\">{{likeNum}}</van-tabbar-item>\r\n    <van-action-sheet v-model=\"show\"\r\n                      title=\"评论\">\r\n      <van-cell-group v-if=\"commentsLength\"\r\n                      inset\r\n                      class=\"blogm-article--comment\">\r\n        <Vuescroll :ops=\"ops\"\r\n                   ref=\"comment_area\">\r\n          <div v-for=\"(item,idx) in commentList\"\r\n               :key=\"item._id\"\r\n               :id='`comment${idx}`'\r\n               class=\"blogm-comment--cell\">\r\n            <template icon>\r\n              <van-image round\r\n                         width=\"40\"\r\n                         height=\"40\"\r\n                         fit=\"cover\"\r\n                         class=\"blogm-comment--avatar \"\r\n                         :src=\"item.uid.avatar\" />\r\n            </template>\r\n            <div class=\"blogm-comment--content\">\r\n              <van-cell cell-label-font-size=\"16px\"\r\n                        :title=\"item.uid.nikname\"\r\n                        :label=\"item.content\" />\r\n              <van-cell class=\"blogm-comment--date\"\r\n                        :value=\"item.date\" />\r\n            </div>\r\n          </div>\r\n        </Vuescroll>\r\n      </van-cell-group>\r\n      <van-empty v-else\r\n                 description=\"暂无评论\" />\r\n      <van-field class=\"blogm-comment--input\"\r\n                 v-model=\"commentVal\"\r\n                 maxlength=\"50\"\r\n                 placeholder=\"请输入评论内容\">\r\n        <template #button>\r\n          <van-button class=\"blogm-comment--btn\"\r\n                      size=\"small\"\r\n                      type=\"primary\"\r\n                      @click=\"submitComment\">发送</van-button>\r\n        </template>\r\n      </van-field>\r\n    </van-action-sheet>\r\n  </van-tabbar>\r\n</template>\r\n\r\n<script>\r\nimport Vuescroll from 'vuescroll'\r\nimport { Toast } from 'vant'\r\nimport { createNamespacedHelpers } from 'vuex'\r\nconst { mapGetters, mapActions } = createNamespacedHelpers('likes')\r\nexport default {\r\n  name: 'BaseArticleFootBar',\r\n  components: {\r\n    Vuescroll\r\n  },\r\n  props: {\r\n    article: {\r\n      type: String\r\n    }\r\n  },\r\n  data () {\r\n    return {\r\n      isInitLike: false,\r\n      show: false,\r\n      commentVal: '',\r\n      commentList: [],\r\n      ops: {\r\n        bar: {\r\n          background: '#c1c1c1',\r\n        }\r\n      }\r\n    }\r\n  },\r\n  created () {\r\n    this.commentList = this.article?.comments?.reverse()\r\n    this.isInitLike = this.isLike\r\n  },\r\n  computed: {\r\n    commentsLength () {\r\n      return this.article?.comments?.length\r\n    },\r\n    isLike () {\r\n      return this.hadLike(this.article?.id)\r\n    },\r\n    likeNum () {\r\n      let step = Number(this.isLike) - 1\r\n      return Math.max(this.article?.like_num + !this.isInitLike + step, 0)\r\n    },\r\n    hitNum () {\r\n      return this.article?.hit_num\r\n    },\r\n    commentNum () {\r\n      return this.article?.comment_num\r\n    },\r\n    ...mapGetters(['hadLike'])\r\n  },\r\n  watch: {\r\n\r\n  },\r\n  methods: {\r\n    comment () {\r\n      this.show = true\r\n    },\r\n    like () {\r\n      this[this.isLike ? 'pullLikes' : 'pushLikes']({ aid: this.article._id })\r\n      this.updateLikes({ aid: this.article._id })\r\n    },\r\n    ...mapActions(['pullLikes', 'pushLikes', 'updateLikes']),\r\n    async submitComment () {\r\n      let isLogin = this.$store.state.token\r\n      if (!isLogin) {\r\n        Toast({ message: '登录后即可发表评论' })\r\n        this.$router.push({ name: 'mUser', query: 'MUser' })\r\n        return\r\n      }\r\n      if (this.commentVal.trim().length === 0) {\r\n        Toast({ message: '请输入评论内容' })\r\n        return\r\n      }\r\n      try {\r\n        await this.$api({ type: 'postComment', data: { aid: this.article._id, content: this.commentVal } })\r\n        Toast.success('评论成功')\r\n        this.$EventBus.$emit('uploadArticle')\r\n        this.$EventBus.$on('articleInfo', data => {\r\n          this.commentList = data.comments.reverse()\r\n        })\r\n      } catch (error) {\r\n        Toast({ message: error })\r\n      }\r\n      this.commentVal = ''\r\n    }\r\n  },\r\n  beforeDestroy () {\r\n    this.$EventBus.$off('articleInfo')\r\n  }\r\n}\r\n</script>\r\n<style lang='stylus'>\r\n.blogm-article--like.active\r\n  color #1989fa\r\n.blogm-comment--cell\r\n  box-sizing border-box\r\n  display flex\r\n  flex-direction row\r\n  justify-content flex-start\r\n  margin 5px 0\r\n  padding 0 10px\r\n  border-radius 4px\r\n  background-color #f1f1f1\r\n  .van-cell\r\n    padding 0\r\n    background-color #f1f1f1\r\n.blogm-article--comment\r\n  height 40vh\r\n  margin 0\r\n  overflow hidden\r\n.blogm-comment--content\r\n  width 90%\r\n.van-cell__title\r\n  padding 5px\r\n  span\r\n    font-size 12px\r\n    color #969799\r\n.van-cell__label\r\n  font-size 14px\r\n  color #6a737d\r\n.blogm-comment--input\r\n  padding 0\r\n  border 1px solid #ccc\r\n.van-field__control\r\n  text-indent 1em\r\n.blogm-comment--btn\r\n  height 33px\r\n  background-color #969799\r\n  border 0\r\n.blogm-comment--avatar\r\n  margin-top 10px\r\n  .van-image__img\r\n    width 40px\r\n    height 40px\r\n.blogm-comment--date\r\n  span\r\n    float right\r\n    font-size 10px\r\n    color #969799\r\n</style>"]}]}